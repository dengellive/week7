pipeline {
     agent any
     stages {
          git url: "https://git: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@github.com/dengellive/week7.git" , branch "main"
          stage("Compile") {
               steps {
                    sh "chmod +x gradlew"
                    sh "./gradlew compileJava"
               }
          }
          stage("Unit test") {
               steps {
                    sh "./gradlew test"
               }
          }
          stage("Code coverage") {
               steps {
                    sh "./gradlew jacocoTestReport"
                    sh "./gradlew jacocoTestCoverageVerification"
               }
          }
          stage("Static code analysis") {
               steps {
                    sh "./gradlew checkstyleMain"
               }
          }
          stage("Package") {
               steps {
                    sh "./gradlew build"
               }
          } 

          stage("Calculator") {
               agent {
                    kubernetes {
                         yaml '''
                         spec:
                           containers:
                           - name: calculator
                             image: dengel223/hello-kaniko:1.0
                             imagePullPolicy: Always
                             ports:
                             - containerPort: 8080
                             ''' 
                    }
               }
               steps {
                    echo "I am Calculator"
               }
               
          } 
     }
}